#!/usr/bin/env sh

# Get list of changed files
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR)

# Check if any Rust files in packages/core changed
RUST_CHANGED=$(echo "$CHANGED_FILES" | grep -E "^packages/core/.*\.rs$" || true)

# Check if any TS/TSX files in packages/ui changed
TS_CHANGED=$(echo "$CHANGED_FILES" | grep -E "^packages/ui/" || true)

# Check if any root config files changed (biome, ts, etc.)
ROOT_CHANGED=$(echo "$CHANGED_FILES" | grep -E "^\.(ts|tsx|js|jsx|json)$|^biome\.json$|^tsconfig" || true)

# Run Rust lint if core changed
if [ -n "$RUST_CHANGED" ]; then
  echo "ðŸ¦€ Rust files changed, running cargo clippy..."
  (cd packages/core && cargo clippy --all-targets --all-features -- -D warnings)
fi

# Run Biome lint if ui or root TS/JS files changed
if [ -n "$TS_CHANGED" ] || [ -n "$ROOT_CHANGED" ]; then
  echo "ðŸ“¦ TypeScript/JavaScript files changed, running biome check..."
  bunx biome check --staged --no-errors-on-unmatched
fi
